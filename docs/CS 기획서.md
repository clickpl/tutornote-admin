제작자이자 운영자로서 원장님들의 기술적 문의를 해결하고 서비스 설정을 유연하게 지원하기 위한 **'CS 지원 및 대리 로그인 기능'** 기획안을 마크다운 형식으로 정리해 드립니다.
이 설계는 `ROADMAP.md`의 Phase 1 핵심 목표인 **학원/학생 관리 제어**를 구체화한 것이며, 특히 멀티테넌시 환경에서 운영자가 안전하게 사용자 환경을 점검할 수 있는 로직을 포함합니다.

---

# [기획서] TutorNote Master Admin: CS 지원 및 대리 로그인 도구

**버전**: 1.0

**작성일**: 2025-12-29

**상태**: Phase 1 (운영 효율화 및 기술 지원)

**우선순위**: CS 대응 중심 (Support Optimization)

---

## 1. 개요

원장님들이 겪는 UI/UX 오류나 데이터 설정 문제를 실시간으로 파악하고 지원하기 위한 운영자 전용 도구입니다. 비밀번호 공유 없이 안전하게 사용자 환경에 접속하는 **'대리 로그인'**과 학원별 설정값을 제어하는 **'학원 컨트롤러'**를 구축합니다.

---

## 2. 화면 설계 (Wireframe)

### 2.1 학원 목록 및 지원 액션

```text
+--------------------------------------------------------------------------------------------+
|  TutorNote Admin > 학원 관리 > 전체 학원 리스트                                            |
+--------------------------------------------------------------------------------------------+
| [ 학원 검색: __________ ] [ 상태: 전체/활성/정지 ] [ 검색 ]                                |
+--------------------------------------------------------------------------------------------+
|                                                                                            |
| | 학원 ID | 학원명          | 원장님 성함 | 학생수 | 상태   | 관리 액션                     | |
| |---------|-----------------|-------------|--------|--------|-------------------------------| |
| | AC-001  | 클릭플 피아노   | 한성용      | 25명   | 활성   | [상세] [대리로그인] [정지]    | |
| | AC-005  | 베토벤 음악학원 | 김원장      | 12명   | 활성   | [상세] [대리로그인] [정지]    | |
| | AC-012  | 쇼팽 피아노     | 이선생      | 0명    | 대기   | [상세] [대리로그인] [삭제]    | |
| +----------------------------------------------------------------------------------------+ |
+--------------------------------------------------------------------------------------------+

```

### 2.2 대리 로그인 활성 상태 (User App Side)

*대리 로그인 시 운영자에게 노출되는 전용 상단 바*

```text
+--------------------------------------------------------------------------------------------+
| [!] 현재 '클릭플 피아노' 계정으로 대리 로그인 중입니다. (모든 활동이 기록됨)    [로그아웃]  |
+--------------------------------------------------------------------------------------------+
| (기존 TutorNote 앱 UI 노출...)                                                             |
+--------------------------------------------------------------------------------------------+

```

---

## 3. 상세 기능 명세

### 3.1 대리 로그인 (Impersonation)

* **안전한 접근**: 원장님의 실제 비밀번호를 알 필요 없이, Master Admin의 세션을 통해 해당 학원의 `Academy_ID` 권한을 임시 획득합니다.
* **환경 재현**: 원장님이 보고 있는 동일한 대시보드, 출석부, 리포트 생성 화면을 그대로 확인하여 오류를 진단합니다.
* **작업 제한**: 대리 로그인 상태에서는 데이터 조회 및 설정 확인은 자유롭지만, 실제 알림톡 발송이나 결제 관련 민감 액션은 차단하거나 재확인 절차를 둡니다.

### 3.2 학원 정보 및 정책 제어

* **정보 수정**: 학원명, 대표자 연락처 등 원장님이 직접 수정하기 번거로워하는 기본 정보를 관리자 권한으로 변경합니다.
* **출석 정책 강제 변경**: 학원의 상황에 맞춰 '출석번호 자동 할당' 또는 '휴대폰 뒤 4자리' 방식을 운영자가 직접 설정해 줄 수 있습니다.
* **계정 상태 관리**: 미결제 학원이나 약관 위반 학원에 대해 서비스 접속을 즉시 차단(Suspended) 처리합니다.

### 3.3 CS 지원 이력 로그

* **활동 기록**: 운영자가 대리 로그인을 시도한 시점, 대상 학원, 수행한 작업 내용을 로그로 남겨 추후 분쟁을 방지합니다.
* **학생 데이터 복구**: 원장님이 실수로 삭제한 학생 정보를 확인하고, 필요 시 논리 삭제(Soft Delete) 상태를 해제하여 복구합니다.

---

## 4. 기술적 구현 및 보안 (Backend)

* **Impersonation Token**: 마스터 어드민 전용 JWT를 발급하되, `impersonated_academy_id` 클레임을 포함하여 백엔드에서 운영자의 접근임을 식별합니다.
* **Access Control**: 운영자 IP 대역에서만 대리 로그인 API가 호출되도록 제한하여 보안을 강화합니다.
* **Audit Trail**: `admin_action_logs` 테이블을 생성하여 모든 CS 지원 활동을 기록합니다.

---

## 5. 운영자(OX) 포인트

* **시각적 구분**: 대리 로그인 중에는 앱 전체 테두리에 유색 보더(예: 주황색)를 표시하여, 운영자가 자신의 관리자 페이지인지 사용자의 페이지인지 혼동하지 않게 합니다.
* **원터치 지원**: 원장님의 1:1 문의 톡을 확인하면서 바로 해당 학원의 상세 페이지로 이동할 수 있는 딥링크(Deep Link)를 구성합니다.

---