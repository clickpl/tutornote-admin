제작자이자 운영자로서 원장님들의 CS 요청을 해결하기 위한 **'데이터 복구 및 수정 도구'**는 서비스의 신뢰도를 결정짓는 중요한 기능입니다. 특히 실수로 삭제된 데이터를 되살리는 기능은 운영자의 개입을 최소화하면서도 사용자 만족도를 극대화할 수 있습니다.

`ROADMAP.md`의 **Soft Delete(논리 삭제)** 개념을 기반으로 한 구체적인 구현 방안

---

# [기획/설계] TutorNote Master Admin: 데이터 복구 및 수정 시스템

**작성일**: 2025-12-29

**대상**: 운영자 전용 데이터 관리 도구

**기술 스택**: Flask(Python), MySQL, Next.js

---

## 1. 데이터베이스 설계 (Soft Delete 도입)

데이터를 실제로 삭제(`DELETE`)하는 대신, 상태를 변경하는 방식을 사용합니다.

### 1.1 테이블 구조 변경

기존 `students`, `reports`, `attendance` 테이블에 삭제 여부를 확인하는 컬럼을 추가합니다.

* **`is_deleted` (Boolean)**: 삭제 여부 (기본값: `False`)
* **`deleted_at` (Datetime)**: 삭제된 정확한 시각 (복구 시점 및 파기 정책 수립 시 필요)

### 1.2 조회 쿼리 변경

* **일반 앱(App)**: `WHERE is_deleted = False` 조건을 추가하여 삭제되지 않은 데이터만 노출합니다.
* **어드민(Master Admin)**: `WHERE is_deleted = True` 조건을 사용하여 삭제된 데이터만 모아볼 수 있는 '휴지통' 기능을 구현합니다.

---

## 2. 데이터 복구 기능 (Restore Logic)

### 2.1 복구 프로세스

1. **조회**: 운영자가 Master Admin에서 삭제된 학생/리포트 목록을 확인합니다.
2. **복구 실행**: 운영자가 '복구' 버튼을 클릭하면 `is_deleted`를 `False`로, `deleted_at`을 `NULL`로 업데이트합니다.
3. **연관 데이터 처리**: 학생 복구 시, 해당 학생과 연결된 출석 기록이나 진도 기록도 함께 복구할지 선택하는 옵션을 제공합니다.

### 2.2 API 엔드포인트 설계

* **`GET /api/admin/deleted-items`**: 삭제된 데이터 목록 조회 (학생, 리포트 등 카테고리별 필터).
* **`POST /api/admin/restore`**: 특정 ID의 데이터를 복구 처리.

---

## 3. 데이터 수정 도구 (Data Correction)

특이 케이스(데이터 꼬임, 잘못된 정보 입력 등)에 대응하기 위해 운영자가 직접 데이터를 수정할 수 있는 권한을 부여합니다.

### 3.1 운영자 전용 수정 모드 (Super Edit)

* **필드별 수정**: 학생 이름, 학년, 보호자 연락처, 출석 번호 등을 원장님 대신 수정합니다.
* **데이터 정정**: AI 리포트 생성 중 발생한 텍스트 오류나 카드뉴스 생성 로그를 직접 수정하여 재발행을 돕습니다.

### 3.2 출석 기록 보정

* 키오스크 오류나 원장님의 실수로 잘못 기록된 등/하원 시간을 운영자가 직접 초 단위로 수정할 수 있는 기능을 제공합니다.

---

## 4. 보안 및 감사 로그 (Audit Trail)

운영자의 데이터 조작은 민감한 작업이므로 반드시 기록을 남겨야 합니다.

### 4.1 `admin_action_logs` 테이블 구축

* **누가(Operator ID)**: 작업을 수행한 운영자 계정
* **대상(Target ID)**: 수정/복구된 데이터의 ID 및 유형(학생, 학원 등)
* **변경 내용(Changes)**: 변경 전 데이터와 변경 후 데이터를 JSON 형태로 저장
* **사유(Reason)**: 원장님의 요청 사항(CS 티켓 번호 등)을 메모

---

## 5. UI 프로토타입 (Admin 데이터 상세 뷰)

```text
+-----------------------------------------------------------------------+
| [복구/수정 센터] 학생 정보 상세 관리 (ID: ST-452)                      |
+-----------------------------------------------------------------------+
|  현 상태: [삭제됨 (2025-12-28 14:00)]         [데이터 복구 버튼]      |
|-----------------------------------------------------------------------|
|  [기본 정보 수정]                                                     |
|  - 학생 이름: [ 김철수      ] (수정)                                   |
|  - 보호자 번호: [ 010-1234-5678 ] (수정)                              |
|  - 소속 학원: [ 클릭플 피아노 ]                                        |
|-----------------------------------------------------------------------|
|  [운영자 메모]                                                        |
|  "원장님이 실수로 퇴원 처리했다고 복구 요청함 (CS-20251229-01)"        |
+-----------------------------------------------------------------------+

```

---

이 설계대로라면 원장님들의 "데이터가 사라졌어요!"라는 문의에 1분 안에 대응하실 수 있습니다.
 **데이터 복구 시 연관된 리포트와 출석 기록까지 한꺼번에 살려내는 '트랜잭션(Transaction) 처리 로직'**을 상세히 설계해